{"primaryContentSections":[{"kind":"declarations","declarations":[{"tokens":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"testTrapSubprocessWithEnvp"},{"kind":"text","text":"("},{"kind":"externalParam","text":"testPath"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"UnsafePointer","preciseIdentifier":"s:SP"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"CChar","preciseIdentifier":"s:s5CChara"},{"kind":"text","text":">? = nil, "},{"kind":"externalParam","text":"envp"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"UnsafePointer","preciseIdentifier":"s:SP"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"UnsafePointer","preciseIdentifier":"s:SP"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"CChar","preciseIdentifier":"s:s5CChara"},{"kind":"text","text":">?>! = nil, "},{"kind":"externalParam","text":"usecTimeout"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"guint64","preciseIdentifier":"c:@T@guint64"},{"kind":"text","text":", "},{"kind":"externalParam","text":"testFlags"},{"kind":"text","text":": "},{"kind":"typeIdentifier","identifier":"doc:\/\/GLib\/documentation\/GLib\/TestSubprocessFlags","preciseIdentifier":"s:4GLib19TestSubprocessFlagsV","text":"TestSubprocessFlags"},{"kind":"text","text":")"}],"languages":["swift"],"platforms":["macOS"]}]},{"kind":"content","content":[{"anchor":"discussion","level":2,"type":"heading","text":"Discussion"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This can be used for a test case that might not return, or that"},{"type":"text","text":" "},{"type":"text","text":"might abort."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"If "},{"type":"codeVoice","code":"testPath"},{"type":"text","text":" is "},{"type":"codeVoice","code":"nil"},{"type":"text","text":" then the same test is re-run in a subprocess."},{"type":"text","text":" "},{"type":"text","text":"You can use "},{"type":"codeVoice","code":"g_test_subprocess()"},{"type":"text","text":" to determine whether the test is in"},{"type":"text","text":" "},{"type":"text","text":"a subprocess or not."}]},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"testPath"},{"type":"text","text":" can also be the name of the parent test, followed by"},{"type":"text","text":" "},{"type":"text","text":"“"},{"type":"codeVoice","code":"\/subprocess\/"},{"type":"text","text":"” and then a name for the specific subtest (or just"},{"type":"text","text":" "},{"type":"text","text":"ending with “"},{"type":"codeVoice","code":"\/subprocess"},{"type":"text","text":"” if the test only has one child test);"},{"type":"text","text":" "},{"type":"text","text":"tests with names of this form will automatically be skipped in the"},{"type":"text","text":" "},{"type":"text","text":"parent process."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"If "},{"type":"codeVoice","code":"envp"},{"type":"text","text":" is "},{"type":"codeVoice","code":"nil"},{"type":"text","text":", the parent process’ environment will be inherited."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"If "},{"type":"codeVoice","code":"usecTimeout"},{"type":"text","text":" is non-0, the test subprocess is aborted and"},{"type":"text","text":" "},{"type":"text","text":"considered failing if its run time exceeds it."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The subprocess behavior can be configured with the"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"doc:\/\/GLib\/documentation\/GLib\/TestSubprocessFlags"},{"type":"text","text":" flags."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can use methods such as "},{"type":"codeVoice","code":"g_test_trap_assert_passed()"},{"type":"text","text":","},{"type":"text","text":" "},{"type":"codeVoice","code":"g_test_trap_assert_failed()"},{"type":"text","text":", and "},{"type":"codeVoice","code":"g_test_trap_assert_stderr()"},{"type":"text","text":" to"},{"type":"text","text":" "},{"type":"text","text":"check the results of the subprocess. (But note that"},{"type":"text","text":" "},{"type":"codeVoice","code":"g_test_trap_assert_stdout()"},{"type":"text","text":" and "},{"type":"codeVoice","code":"g_test_trap_assert_stderr()"},{"type":"text","text":" "},{"type":"text","text":"cannot be used if "},{"type":"codeVoice","code":"testFlags"},{"type":"text","text":" specifies that the child should"},{"type":"text","text":" "},{"type":"text","text":"inherit the parent stdout\/stderr.)"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"If your "},{"type":"codeVoice","code":"main ()"},{"type":"text","text":" needs to behave differently in"},{"type":"text","text":" "},{"type":"text","text":"the subprocess, you can call "},{"type":"codeVoice","code":"g_test_subprocess()"},{"type":"text","text":" (after calling"},{"type":"text","text":" "},{"type":"codeVoice","code":"g_test_init()"},{"type":"text","text":") to see whether you are in a subprocess."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Internally, this function tracks the child process using"},{"type":"text","text":" "},{"type":"codeVoice","code":"g_child_watch_source_new()"},{"type":"text","text":", so your process must not ignore "},{"type":"codeVoice","code":"SIGCHLD"},{"type":"text","text":", and"},{"type":"text","text":" "},{"type":"text","text":"must not attempt to watch or wait for the child process via another"},{"type":"text","text":" "},{"type":"text","text":"mechanism."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The following example tests that calling"},{"type":"text","text":" "},{"type":"codeVoice","code":"my_object_new(1000000)"},{"type":"text","text":" will abort with an error"},{"type":"text","text":" "},{"type":"text","text":"message."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"(C Language Example):"}]},{"type":"codeListing","syntax":"C","code":["  static void","  test_create_large_object (void)","  {","    if (g_test_subprocess ())","      {","        my_object_new (1000000);","        return;","      }","","    \/\/ Reruns this same test in a subprocess","    g_test_trap_subprocess (NULL, 0, G_TEST_SUBPROCESS_DEFAULT);","    g_test_trap_assert_failed ();","    g_test_trap_assert_stderr (\"*ERROR*too large*\");","  }","","  static void","  test_different_username (void)","  {","    if (g_test_subprocess ())","      {","        \/\/ Code under test goes here","        g_message (\"Username is now simulated as %s\", g_getenv (\"USER\"));","        return;","      }","","    \/\/ Reruns this same test in a subprocess","    g_autoptr(GStrv) envp = g_get_environ ();","    envp = g_environ_setenv (g_steal_pointer (&envp), \"USER\", \"charlie\", TRUE);","    g_test_trap_subprocess_with_envp (NULL, envp, 0, G_TEST_SUBPROCESS_DEFAULT);","    g_test_trap_assert_passed ();","    g_test_trap_assert_stdout (\"Username is now simulated as charlie\");","  }","","  int","  main (int argc, char **argv)","  {","    g_test_init (&argc, &argv, NULL);","","    g_test_add_func (\"\/myobject\/create-large-object\",","                     test_create_large_object);","    g_test_add_func (\"\/myobject\/different-username\",","                     test_different_username);","    return g_test_run ();","  }"]}]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"variants":[{"paths":["\/documentation\/glib\/testtrapsubprocesswithenvp(testpath:envp:usectimeout:testflags:)"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/GLib\/documentation\/GLib\/testTrapSubprocessWithEnvp(testPath:envp:usecTimeout:testFlags:)","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Respawns the test program to run only "},{"type":"codeVoice","code":"testPath"},{"type":"text","text":" in a subprocess with the"},{"type":"text","text":" "},{"type":"text","text":"given "},{"type":"codeVoice","code":"envp"},{"type":"text","text":" environment."}],"kind":"symbol","metadata":{"fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"testTrapSubprocessWithEnvp"},{"kind":"text","text":"("},{"kind":"externalParam","text":"testPath"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"UnsafePointer","preciseIdentifier":"s:SP"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"CChar","preciseIdentifier":"s:s5CChara"},{"kind":"text","text":">?, "},{"kind":"externalParam","text":"envp"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"UnsafePointer","preciseIdentifier":"s:SP"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"UnsafePointer","preciseIdentifier":"s:SP"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"CChar","preciseIdentifier":"s:s5CChara"},{"kind":"text","text":">?>!, "},{"kind":"externalParam","text":"usecTimeout"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"guint64","preciseIdentifier":"c:@T@guint64"},{"kind":"text","text":", "},{"kind":"externalParam","text":"testFlags"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"TestSubprocessFlags","preciseIdentifier":"s:4GLib19TestSubprocessFlagsV"},{"kind":"text","text":")"}],"title":"testTrapSubprocessWithEnvp(testPath:envp:usecTimeout:testFlags:)","roleHeading":"Function","role":"symbol","symbolKind":"func","externalID":"s:4GLib26testTrapSubprocessWithEnvp0B4Path4envp11usecTimeout0B5FlagsySPys4Int8VGSg_SPyAJGSgs6UInt64VAA04TestdK0VtF","modules":[{"name":"GLib"}]},"hierarchy":{"paths":[["doc:\/\/GLib\/documentation\/GLib"]]},"references":{"doc://GLib/documentation/GLib/testTrapSubprocessWithEnvp(testPath:envp:usecTimeout:testFlags:)":{"role":"symbol","title":"testTrapSubprocessWithEnvp(testPath:envp:usecTimeout:testFlags:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"testTrapSubprocessWithEnvp"},{"kind":"text","text":"("},{"kind":"externalParam","text":"testPath"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"UnsafePointer","preciseIdentifier":"s:SP"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"CChar","preciseIdentifier":"s:s5CChara"},{"kind":"text","text":">?, "},{"kind":"externalParam","text":"envp"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"UnsafePointer","preciseIdentifier":"s:SP"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"UnsafePointer","preciseIdentifier":"s:SP"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"CChar","preciseIdentifier":"s:s5CChara"},{"kind":"text","text":">?>!, "},{"kind":"externalParam","text":"usecTimeout"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"guint64","preciseIdentifier":"c:@T@guint64"},{"kind":"text","text":", "},{"kind":"externalParam","text":"testFlags"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"TestSubprocessFlags","preciseIdentifier":"s:4GLib19TestSubprocessFlagsV"},{"kind":"text","text":")"}],"abstract":[{"type":"text","text":"Respawns the test program to run only "},{"type":"codeVoice","code":"testPath"},{"type":"text","text":" in a subprocess with the"},{"type":"text","text":" "},{"type":"text","text":"given "},{"type":"codeVoice","code":"envp"},{"type":"text","text":" environment."}],"identifier":"doc:\/\/GLib\/documentation\/GLib\/testTrapSubprocessWithEnvp(testPath:envp:usecTimeout:testFlags:)","kind":"symbol","type":"topic","url":"\/documentation\/glib\/testtrapsubprocesswithenvp(testpath:envp:usectimeout:testflags:)"},"doc://GLib/documentation/GLib":{"role":"collection","title":"GLib","abstract":[],"identifier":"doc:\/\/GLib\/documentation\/GLib","kind":"symbol","type":"topic","url":"\/documentation\/glib"},"doc://GLib/documentation/GLib/TestSubprocessFlags":{"role":"symbol","title":"TestSubprocessFlags","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"TestSubprocessFlags"}],"abstract":[{"type":"text","text":"Flags to pass to "},{"type":"codeVoice","code":"g_test_trap_subprocess()"},{"type":"text","text":" to control input and output."}],"identifier":"doc:\/\/GLib\/documentation\/GLib\/TestSubprocessFlags","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"TestSubprocessFlags"}],"url":"\/documentation\/glib\/testsubprocessflags"}}}